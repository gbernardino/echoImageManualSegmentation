(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{149:function(e,t){},154:function(e,t){},156:function(e,t){},172:function(e,t){},204:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(83),o=n.n(i),l=(n(99),n(18)),c=n(48),u=n(15),s=n(85),d=n.n(s),h=n(86),f=Object(h.a)(function(e){return{width:window.innerWidth,height:window.innerHeight,setSize:function(t){var n=t.width,a=t.height;return e({width:n,height:a})},imageWidth:100,imageHeight:100,imageURL:null,setImageURL:function(t){return e({imageURL:t})},setImageSize:function(t){return e(function(){return{imageWidth:t.width,imageHeight:t.height}})},scale:1,setScale:function(t){return e({scale:t})},brightness:0,setBrightness:function(t){return e({brightness:t})},modeInteraction:"add",setInteraction:function(t){return e({modeInteraction:t})},polyline:[],setPolyline:function(t){return e({polyline:t})}}}),g=Object(l.a)(f,1)[0];var m=1+Math.round(1*Math.random()),p="image-".concat(m,".jpg"),v=function(){var e=g(function(e){return e.imageURL}),t=null===e?p:e,n=d()(t,"Anonymous"),a=Object(l.a)(n,1)[0],i=g(function(e){return e.setImageSize}),o=g(function(e){return e.setScale}),c=g(function(e){return e.setSize}),s=g(function(e){return e.width}),h=g(function(e){return e.height}),f=g().brightness;g(function(e){return e.polyline}),g(function(e){return e.setPolyline}),g(function(e){return e.modeInteraction});r.a.useEffect(function(){if(a){var e=Math.min(s/a.width,h/a.height);o(e),i({width:a.width,height:a.height});var t=a.width/a.height;c({width:s,height:s/t})}},[a,s,h,o,i,c]);var m=r.a.useRef(null);return r.a.useEffect(function(){m.current.getCanvas()._canvas.style.filter="brightness(".concat(100*(f+1),"%)")},[f]),r.a.createElement(u.c,{ref:m},r.a.createElement(u.b,{image:a}))};var y=function(){var e=g(function(e){return e.polyline}),t=g(function(e){return e.setPolyline}),n=r.a.useRef(null);return r.a.createElement(u.c,{ref:n},r.a.createElement(u.d,{name:"polyline",points:e,strokeWidth:1,stroke:"purple"}),function(e,t){for(var n=e.length/2,a=[],i=function(n){a.push(r.a.createElement(u.a,{key:"Node_"+n,x:e[2*n],y:e[2*n+1],radius:3,fill:"red",draggable:!0,onDragEnd:function(a){e[2*n]=a.target.x(),e[2*n+1]=a.target.y(),t(e)},onDragMove:function(t){e[2*n]=t.target.x(),e[2*n+1]=t.target.y()}}))},o=0;o<n;o++)i(o);return a}(e,t))};function x(e,t,n,a,r,i){var o,l,c=r-n,u=i-a,s=c*c+u*u,d=-1;0!==s&&(d=((e-n)*c+(t-a)*u)/s),d<0?(o=n,l=a):d>1?(o=r,l=i):(o=n+d*c,l=a+d*u);var h=e-o,f=t-l;return Math.sqrt(h*h+f*f)}function w(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=e.scaleX(),r={x:e.width()/2,y:e.height()/2};null!=n&&(r.x=n.x,r.y=n.y);var i=r.x/a-e.x()/a,o=r.y/a-e.y()/a,l=Math.max(.05,a*t),u={x:-(i-r.x/l)*l,y:-(o-r.y/l)*l},s=function(e,t){var n=e.findOne("Image").getClientRect(),a=-n.width+e.width()/2,r=e.width()/2,i=Math.max(a,Math.min(t.x,r)),o=-n.height+e.height()/2,l=e.height()/2,c=Math.max(o,Math.min(t.y,l)),u=Math.max(.05,t.scale);return{x:i,y:c,scale:u}}(e,Object(c.a)(Object(c.a)({},u),{},{scale:l}));e.to({x:s.x,y:s.y,scaleX:s.scale,scaleY:s.scale,duration:.1})}var E=function(){var e=r.a.useRef(),t=g(function(e){return{width:e.width,height:e.height}}),n=t.width,a=t.height,i=g(function(e){return e.setSize}),o=g(function(e){return e.scale}),l=g(function(e){return e.polyline}),c=g(function(e){return e.setPolyline}),s=g(function(e){return e.modeInteraction});return r.a.useEffect(function(){function e(){var e=document.querySelector(".right-panel");i({width:e.offsetWidth,height:a})}return e(),window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}},[]),r.a.createElement(r.a.Fragment,null,r.a.createElement(u.e,{ref:e,width:n,height:a,scaleX:o,scaleY:o,className:"canvas",draggable:!0,onClick:function(e){var t=function(e){var t=e.getAbsoluteTransform().copy();t.invert();var n=e.getStage().getPointerPosition();return t.point(n)}(e.target.getStage());if("add"===s){var n=l.concat([t.x,t.y]);c(n)}else if("remove"===s){var a=function(e,t,n){for(var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:50,r=-1,i=a*a,o=0;o<e.length/2;o++){var l=e[2*o]-t,c=e[2*o+1]-n,u=l*l+c*c;u<i&&(r=o,i=u)}return r}(l,t.x,t.y);a>=0&&(l.splice(2*a,2),c(l))}else if("split"===s){var r=function(e,t,n){for(var a=-1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:50,i=0;i<e.length/2-1;i++){var o=x(t,n,e[2*i],e[2*i+1],e[2*i+2],e[2*i+3]);o<r&&(a=i,r=o)}return console.log(r),a}(l,t.x,t.y);r>=0&&(console.log(l),l.splice(2*r+2,0,t.x,t.y),console.log(l),c(l))}}},r.a.createElement(v,null),r.a.createElement(y,null)),r.a.createElement("div",{className:"zoom-container"},r.a.createElement("button",{onClick:function(){w(e.current,1.2)}},"+"),r.a.createElement("button",{onClick:function(){w(e.current,.8)}},"-")))},b=n(92),S=n(58);n(59);var O=n(87),R=n.n(O),P=n(39),D=n(88),M=n(40),C=n(89),A=n.n(C),k=n(30),I=n(90),j=n(93),U=n(19),T=n(20),W=function(){function e(){Object(U.a)(this,e),this.sor=[],this.addSOR(0,0,1,1,"Pixels")}return Object(T.a)(e,[{key:"addSOR",value:function(e,t,n,a,r){this.sor.push({x0:e,y0:t,xScale:n,yScale:a,name:r})}},{key:"getOptionsList",value:function(){for(var e=[],t=0;t<this.sor.length;t+=1)e.push({value:String(t),label:this.sor[t].name});return e}}]),e}();function L(e){switch(e){case 1:return"Tissue";case 2:return"Color Flow";case 3:return"PW Spectral Doppler";case 4:return"CW Spectral Doppler";case 5:return"Doppler Mean Trace";case 6:return"Doppler Mode Trace";case 7:return"Doppler Max Trace";case 8:return"Volume Trace";case 10:return"ECG Trace";case 11:return"Pulse Trace";case 12:return"Phonocardiogram Trace";case 13:return"Gray bar";case 14:return"Color bar";case 15:return"Integrated Backscatter";case 16:return"Area Trace";case 16:return"d(area)/dt";case 18:return"Other Physiological (Amplitude vs. Time) input";default:return"Unknown"}}n(150);var z=n(151),F=window.hdf5,N=n(201);function X(e,t){var n="data:text/csv;charset=utf-8,",a=function(e,t){for(var n=Object(j.a)(e),a=0;a<e.length;a+=2)n[a]=(e[a+1]-t.x0)*t.xScale,n[a+1]=(e[a+1]-t.y0)*t.yScale;return n}(e,t);n+="x0, y0,"+t.name+"\n";for(var r=0;r<a.length;r+=2)n+=String(a[r])+","+String(a[r+1])+", \n";var i=encodeURI(n),o=document.createElement("a");o.setAttribute("href",i),o.setAttribute("download","my_data.csv"),document.body.appendChild(o),o.click()}M.external.cornerstone=P,M.external.cornerstoneMath=D,M.external.Hammer=A.a,k.external.dicomParser=I,k.external.cornerstone=P;var q=function(){var e=g().setBrightness,t=g().setInteraction,n=g().setImageURL,i=g().polyline,o=g(function(e){return e.setPolyline});k.configure({useWebWorkers:!1});var c=Object(a.useState)(new W),u=Object(l.a)(c,2),s=u[0],d=u[1],h=Object(a.useState)(0),f=Object(l.a)(h,2),m=f[0],p=f[1],v=Object(a.useCallback)(function(e){var t=e[0].filename,a=e[0].type,r=new FileReader;r.onloadend=function(r){for(var i=!1,o=new Uint8Array(r.target.result),l="",c=128;c<132;++c)l+=String.fromCharCode(o[c]);"DICM"==l&&(i=!0);var u=r.target.result,s=new W;if("application/h5"===a){var h=new F.File(u,t),f=function(e,t,n){for(var a=e.get("Tissue"),r=a.shape,i=r[1],o=r[2],l=S(a.value,r).pick(n,null,null),c=S(new Float32Array(t.nPixelsX*t.nPixelsY),[t.nPixelsX,t.nPixelsY]),u=0;u<t.nPixelsX;u++)for(var s=0;s<t.nPixelsY;s++){var d=t.R_idx.get(u,s),h=t.theta_idx.get(u,s);d<0||d>=o?c.set(u,s,0):h<0||h>=i?c.set(u,s,0):c.set(u,s,l.get(h,d))}return c}(h,function(e,t){for(var n=e.get("Tissue"),a=n.shape,r=a[1],i=a[2],o=n.attrs.Width/r,l=-n.attrs.Width/2,c=n.attrs.DepthEnd/i,u=(n.attrs.Tilt,n.attrs.DepthEnd),s=n.attrs.DepthEnd*Math.sin(n.attrs.Width/2),d=-s,h=Math.ceil((u-0)/t),f=Math.ceil((s-d)/t),g=(n.attrs.Origo[0],n.attrs.Origo[1],S(new Float32Array(h*f),[h,f])),m=S(new Float32Array(h*f),[h,f]),p=0;p<h;p++)for(var v=0;v<f;v++)g.set(p,v,0+p*(u-0)/h),m.set(p,v,d+v*(s-d)/f);for(var y=S(new Int32Array(h*f),[h,f]),x=S(new Int32Array(h*f),[h,f]),w=0;w<h;w++)for(var E=0;E<f;E++){var b=g.get(w,E),O=m.get(w,E);y.set(w,E,Math.round(Math.sqrt(b*b+O*O)/c)),x.set(w,E,Math.round((Math.atan(O/b)-l)/o))}return{R_idx:y,theta_idx:x,nPixelsX:h,nPixelsY:f}}(h,1e-4),0),g=z(f.pick(-1,-1,0),"CANVAS");n(g.toDataURL())}else if("application/dicom"===a|i){var m=k.wadouri.fileManager.add(e[0]);P.loadAndCacheImage(m).then(function(e){return n(e.getCanvas().toDataURL())});for(var p=N.data.DicomMessage.readFile(u),v=N.data.DicomMetaDictionary.naturalizeDataset(p.dict),y=0;y<v.SequenceOfUltrasoundRegions.length;y++)s.addSOR(v.SequenceOfUltrasoundRegions[y].ReferencePixelX0,v.SequenceOfUltrasoundRegions[y].ReferencePixelX1,v.SequenceOfUltrasoundRegions[y].PhysicalDeltaX,v.SequenceOfUltrasoundRegions[y].PhysicalDeltaY,L(v.SequenceOfUltrasoundRegions[y].RegionDataType))}else console.log("error");d(s)},r.readAsArrayBuffer(e[0])},[]),y=Object(b.a)({onDrop:v}),x=y.getRootProps,w=y.getInputProps,O=y.isDragActive;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"App"},r.a.createElement("div",{className:"left-panel"},r.a.createElement("div",Object.assign({},x(),{style:{boxShadow:"0 0 5px grey}",border:"1px solid grey",textAlign:"center",top:0,z_index:999}}),r.a.createElement("input",w()),O?r.a.createElement("p",null,"Drop the h5 here ..."):r.a.createElement("p",null,"Drag 'n' drop some files here, or click to select files")),r.a.createElement("div",null,"Brigthess",r.a.createElement("input",{id:"slider",type:"range",min:"-1",max:"1",step:"0.05",defaultValue:"0",onChange:function(t){e(parseFloat(t.target.value))}})),r.a.createElement("div",{style:{},onChange:function(e){t(e.target.value)}},r.a.createElement("div",null,r.a.createElement("p",null," Node Interaction:"),r.a.createElement("input",{type:"radio",value:"add",name:"interaction"})," Add",r.a.createElement("input",{type:"radio",value:"remove",name:"interaction"})," Remove",r.a.createElement("input",{type:"radio",value:"split",name:"interaction"})," Split"),r.a.createElement("br",null),r.a.createElement(R.a,{placeholder:"Select export unit",options:s.getOptionsList(),onChange:function(e){return p(e.value)}}),r.a.createElement("div",null,r.a.createElement("button",{onClick:function(e){o([])},type:"button",className:"button"},"Delete segmentation")),r.a.createElement("div",null,r.a.createElement("button",{type:"button",className:"button",onClick:function(e){console.log(m),X(i,s.sor[m])}}," Download segmentation ")))),r.a.createElement("div",{className:"right-panel"},r.a.createElement(E,null))))},_=document.getElementById("root");o.a.render(r.a.createElement(q,null),_)},95:function(e,t,n){e.exports=n(204)},99:function(e,t,n){}},[[95,1,2]]]);
//# sourceMappingURL=main.57abfdee.chunk.js.map